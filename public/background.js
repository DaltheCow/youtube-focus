!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}({1:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return r}));var o=function(e,t){var n="settings"===e?chrome.storage.sync:chrome.storage.local,o=new Promise((function(t){n.get(e,(function(e){return t(e)}))}));return t?o.then(t):o},i=function(e,t,n){var o="settings"===e?chrome.storage.sync:chrome.storage.local,i=new Promise((function(n){o.set(t,(function(){o.get(e,(function(e){return n(e)}))}))}));return n?i.then(n):i},r=function(e,t){var n=e.map((function(e){return{key:e,storage:chrome.storage["settings"===e?"sync":"local"]}})),o=Promise.all(n.map((function(e){var t=e.storage,n=e.key;return new Promise((function(e){t.get(n,(function(t){return e(t)}))}))}))).then((function(t){var n={};return t.forEach((function(t,o){return n[e[o]]=t[e[o]]})),n}));return t?o.then(t):o}},15:function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(3),r=n(2);function a(e,t,n,o){var i=Object(r.a)(t),a=i.isPL,s=i.PlID,c=i.isVid,l=i.vidID;i.notYt;a&&c?(n.includes(l)||o.includes(s))&&chrome.tabs.sendMessage(e,{action:"gatherPLInfo2"}):a?o.includes(s)&&chrome.tabs.sendMessage(e,{action:"gatherPLInfo"}):c&&n.includes(l)&&chrome.tabs.sendMessage(e,{action:"gatherVideoInfo"})}function s(e,t,n){var o={action:"hideField",value:e,field:t};n&&chrome.tabs.sendMessage(n,o),chrome.tabs.query({},(function(e){Array.from(e).forEach((function(e){return chrome.tabs.sendMessage(e.id,o)}))}))}function c(e,t,n,o){var i=Object(r.a)(t),a=i.isPL,s=i.PlID,c=i.isVid,l=i.vidID,u=i.notYt;(c&&!a&&!n.includes(l)||a&&!o.includes(s)||!c&&!a&&!u)&&chrome.tabs.update(e,{url:"not_available/not_available.html"})}chrome.runtime.onMessage.addListener((function(e,t,n){var i=t.tab.id,l=t.tab.url;switch(e.action){case"showPageAction":chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(e.length>0){var t=Object(r.a)(e[0].url);(t.isPL||t.isVid)&&chrome.pageAction.show(e[0].id)}}));var u=Object(r.a)(l);(u.isPL||u.isVid)&&chrome.pageAction.show(i);break;case"getState":Object(o.a)("settings",(function(e){e.settings.enableContentBlocking&&c(i,l,e.settings.allowedVideos,e.settings.allowedPlaylists),a(i,l,e.settings.allowedVideos,e.settings.allowedPlaylists),["hideRelated","hideComments","hideEndScreen"].forEach((function(t){s(e.settings[t],t,i)}))}));break;case"receiveStorageInfo":var d=e.url,f=e.type,g=e.vidInfo,h=e.plInfo,b=e.info,v=Object(r.a)(d),m=(v.isPL,v.PlID),w=(v.isVid,v.vidID);Object(o.a)(["plStorage","videoStorage"],(function(e){var t=e.plStorage,n=e.videoStorage;switch(f){case"receivePL":var i=Object.assign({},t);i[m]=i[m]||{},i[m]=Object.assign({},t[m],b),Object(o.c)("plStorage",{plStorage:i});break;case"receivePL2":var r=Object.assign({},t),a=Object.assign({},n);r[m]=Object.assign({},r[m],h),a[w]=Object.assign({},a[w],g),Object(o.c)("plStorage",{plStorage:r}),Object(o.c)("videoStorage",{videoStorage:a});break;case"receiveVideo":var s=Object.assign({},n);s[w]=s[w]||{},s[w]=Object.assign({},n[w],b),Object(o.c)("videoStorage",{videoStorage:s})}}));break;case"log":console.log(e)}})),chrome.tabs.query({},(function(e){var t=/https:\/\/www.youtube.com\/*/;Array.from(e).filter((function(e){return t.test(e.url)})).forEach((function(e){chrome.pageAction.show(e.id)}))})),Object(o.b)(["settings","videoStorage","plStorage"]).then((function(e){!function(e,t){var n=e.settings||{},i=e.videoStorage||{},r=e.plStorage||{},a=n.hideRelated,s=n.hideComments,c=n.hideEndScreen,l=n.enableContentBlocking,u=n.allowedVideos,d=n.allowedPlaylists;a=Boolean(a),s=Boolean(s),c=Boolean(c),l=Boolean(l),i=void 0===i?{}:i,r=void 0===r?{}:r;var f={hideRelated:a,hideComments:s,hideEndScreen:c,enableContentBlocking:l,allowedVideos:u=void 0===u?[]:u,allowedPlaylists:d=void 0===d?[]:d},g={};Object(o.c)("settings",{settings:f}).then((function(e){return g=Object.assign(g,e),Object(o.c)("plStorage",{plStorage:r})})).then((function(e){return g=Object.assign(g,e),Object(o.c)("videoStorage",{videoStorage:i})})).then((function(e){g=Object.assign(g,e),t(g)}))}(e,(function(e){e.settings.enableContentBlocking&&chrome.tabs.query({},(function(t){var n=/https:\/\/www.youtube.com\/*/;Array.from(t).filter((function(e){return n.test(e.url)})).forEach((function(t){c(t.id,t.url,e.settings.allowedVideos,e.settings.allowedPlaylists)}))})),["hideRelated","hideComments","hideEndScreen"].forEach((function(t){s(e.settings[t],t)}))}))})),chrome.tabs.onUpdated.addListener((function(e,t){if(t.url&&i.b.test(t.url)){var n=Object(r.a)(t.url);n.isPL||n.isVid?chrome.pageAction.show(e):chrome.pageAction.hide(e);var s=/https:\/\/www.youtube.com\/watch*/;Object(o.a)("settings",(function(n){s.test(t.url)&&["hideRelated","hideComments","hideEndScreen"].forEach((function(t){chrome.tabs.sendMessage(e,{action:"hideField",value:n.settings[t],field:t})})),a(e,t.url,n.settings.allowedVideos,n.settings.allowedPlaylists),n.settings.enableContentBlocking&&c(e,t.url,n.settings.allowedVideos,n.settings.allowedPlaylists)}))}})),chrome.storage.onChanged.addListener((function(e,t){if(e.settings){var n=e.settings,o=n.oldValue,r=n.newValue;if(o&&r){var a=o.enableContentBlocking,l=o.allowedVideos,u=o.allowedPlaylists,d=o.hideEndScreen,f=o.hideRelated,g=o.hideComments,h=r.enableContentBlocking,b=r.allowedVideos,v=r.allowedPlaylists,m=r.hideEndScreen,w=r.hideRelated,p=r.hideComments,y=!a&&h,j=l.length>b.length,O=u.length>v.length,S=y||h&&(j||O);f!==w?s(w,"hideRelated"):g!==p?s(p,"hideComments"):d!==m?s(m,"hideEndScreen"):S&&chrome.tabs.query({},(function(e){Array.from(e).filter((function(e){return i.b.test(e.url)})).forEach((function(e){c(e.id,e.url,b,v)}))}))}}}))},2:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(3),i=function(e){var t=e.match(o.a);return{isPL:Boolean(t[1]||t[7]),PlID:t[2]||t[8],isVid:Boolean(t[3]&&t[4]),vidID:t[4]}}},3:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var o=/https:\/\/www.youtube.com\/*/,i=/https:\/\/www\.youtube\.com\/(playlist\?list=(.+))?(watch\?v=([A-Za-z0-9_-]{11}))?(&t=[^&]+)?(&index[^&]+)?(&list=([^&]+)?)?(&.*)?/}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9zdG9yYWdlLmpzIiwid2VicGFjazovLy8uL2JhY2tncm91bmQvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vdXRpbC5qcyIsIndlYnBhY2s6Ly8vLi9jb25zdGFudHMuanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJnZXRTdG9yYWdlIiwiY2FsbGJhY2siLCJzdG9yYWdlIiwiY2hyb21lIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0U3RvcmFnZSIsImRhdGEiLCJnZXRTdG9yYWdlQWxsIiwia2V5cyIsInN0b3JhZ2VzS2V5cyIsInN0b3JhZ2VLZXkiLCJyZXMiLCJpdGVtIiwidXBkYXRlU3RvcmFnZUluZm9Nc2ciLCJ0YWJJZCIsInVybCIsImFsbG93ZWRWaWRlb3MiLCJhbGxvd2VkUGxheWxpc3RzIiwidmlkT3JQTCIsImlzUEwiLCJQbElEIiwiaXNWaWQiLCJ2aWRJRCIsImFjdGlvbiIsInNlbmRTdGF0ZVRvQ29udGVudCIsImZpZWxkIiwibWVzc2FnZSIsIkFycmF5IiwidGFiIiwiYmxvY2tDb250ZW50Iiwibm90WXQiLCJzZW5kZXIiLCJyZXF1ZXN0IiwiYWN0aXZlIiwiY3VycmVudFdpbmRvdyIsInRhYnMiLCJpc1ZpZE9yUGwiLCJ0eXBlIiwidmlkSW5mbyIsInBsSW5mbyIsImluZm8iLCJwbFN0b3JhZ2UiLCJ2aWRlb1N0b3JhZ2UiLCJuZXdQTFN0b3JhZ2UiLCJuZXdWaWRlb1N0b3JhZ2UiLCJjb25zb2xlIiwicmVnZXgiLCJ5dFRhYnMiLCJwcmV2U2V0dGluZ3MiLCJoaWRlUmVsYXRlZCIsImhpZGVDb21tZW50cyIsImhpZGVFbmRTY3JlZW4iLCJlbmFibGVDb250ZW50QmxvY2tpbmciLCJCb29sZWFuIiwic2V0dGluZ3MiLCJuZXdEYXRhIiwiZW5zdXJlU2V0dGluZ3MiLCJjaGFuZ2VJbmZvIiwiWVRfUkVHRVgiLCJ2aWRlb1JlZ2V4IiwiY2hhbmdlcyIsIm9sZFZhbHVlIiwibmV3VmFsdWUiLCJvRW5hYmxlQ29udGVudEJsb2NraW5nIiwib0FsbG93ZWRWaWRlb3MiLCJvQWxsb3dlZFBsYXlsaXN0cyIsIm9IaWRlRW5kU2NyZWVuIiwib0hpZGVSZWxhdGVkIiwib0hpZGVDb21tZW50cyIsIm5FbmFibGVDb250ZW50QmxvY2tpbmciLCJuQWxsb3dlZFZpZGVvcyIsIm5BbGxvd2VkUGxheWxpc3RzIiwibkhpZGVFbmRTY3JlZW4iLCJuSGlkZVJlbGF0ZWQiLCJuSGlkZUNvbW1lbnRzIiwiYmxvY2tFbmFibGVkIiwidmlkUmVtb3ZlZCIsInBsUmVtb3ZlZCIsImJsb2NrVmlkcyIsIlZJRF9QTF9SRUdFWCJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4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MUMsRUFBbUJnRCxFQUFuQmhELGlCQUNTc0QsR0FDVDdFLHNCQUFzQixZQUNwQjBCLHNCQUF3QixTQUFBQyxHQUFHLE9BQUk4QixTQUFjOUIsRUFBbEIsUUFBM0JELFNBQStELFNBQUFDLEdBQzdEQyxFQUFhRCxFQUFELEdBQVNBLEVBQVQsTUFBWkMsZSwrQkMzS1osNkNBRWFYLEVBQVUsU0FBQ0gsR0FDdEIsSUFBTUosRUFBTUksUUFBWixLQUNBLE1BQU8sQ0FBRUksS0FBTWtDLFFBQVExQyxNQUFVQSxFQUExQixJQUNFUyxLQUFNVCxNQUFVQSxFQURsQixHQUVFVSxNQUFPZ0MsUUFBUzFDLE1BQVVBLEVBRjVCLElBR0VXLE1BQU9YLEVBQUksTSwrQkNQdEIsb0VBQU8sSUFBTStDLEVBQU4sK0JBRU1xQixFQUFOIiwiZmlsZSI6ImJhY2tncm91bmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMTUpO1xuIiwiZXhwb3J0IGNvbnN0IGdldFN0b3JhZ2UgPSAoa2V5LCBjYWxsYmFjaykgPT4ge1xuICBjb25zdCBzdG9yYWdlID0gKGtleSA9PT0gJ3NldHRpbmdzJyA/IGNocm9tZS5zdG9yYWdlLnN5bmMgOiBjaHJvbWUuc3RvcmFnZS5sb2NhbCk7XG4gIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgc3RvcmFnZS5nZXQoa2V5LCAoZGF0YSkgPT4gcmVzb2x2ZShkYXRhKSk7XG4gIH0pO1xuICByZXR1cm4gKGNhbGxiYWNrID8gcHJvbWlzZS50aGVuKGNhbGxiYWNrKSA6IHByb21pc2UpO1xufTtcblxuZXhwb3J0IGNvbnN0IHNldFN0b3JhZ2UgPSAoa2V5LCBvYmplY3QsIGNhbGxiYWNrKSA9PiB7XG4gIGNvbnN0IHN0b3JhZ2UgPSAoa2V5ID09PSAnc2V0dGluZ3MnID8gY2hyb21lLnN0b3JhZ2Uuc3luYyA6IGNocm9tZS5zdG9yYWdlLmxvY2FsKTtcbiAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICBzdG9yYWdlLnNldChvYmplY3QsICgpID0+IHtcbiAgICAgIHN0b3JhZ2UuZ2V0KGtleSwgZGF0YSA9PiB7XG4gICAgICAgIHJldHVybiByZXNvbHZlKGRhdGEpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gKGNhbGxiYWNrID8gcHJvbWlzZS50aGVuKGNhbGxiYWNrKSA6IHByb21pc2UpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFN0b3JhZ2VBbGwgPSAoa2V5cywgY2FsbGJhY2spID0+IHtcbiAgY29uc3Qgc3RvcmFnZXNLZXlzID0ga2V5cy5tYXAoa2V5ID0+IHtcbiAgICByZXR1cm4geyBrZXksIHN0b3JhZ2U6IGNocm9tZS5zdG9yYWdlWyhrZXkgPT09ICdzZXR0aW5ncycgPyAnc3luYycgOiAnbG9jYWwnKV0gfTtcbiAgfSk7XG4gIGxldCBwcm9taXNlID0gUHJvbWlzZS5hbGwoc3RvcmFnZXNLZXlzLm1hcChzdG9yYWdlS2V5ID0+IHtcbiAgICBjb25zdCB7IHN0b3JhZ2UsIGtleSB9ID0gc3RvcmFnZUtleTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBzdG9yYWdlLmdldChrZXksIChkYXRhKSA9PiByZXNvbHZlKGRhdGEpKTtcbiAgICB9KTtcbiAgfSkpLnRoZW4ocmVzID0+IHtcbiAgICBjb25zdCBkYXRhID0ge307XG4gICAgcmVzLmZvckVhY2goKGl0ZW0sIGlkeCkgPT4gZGF0YVtrZXlzW2lkeF1dID0gaXRlbVtrZXlzW2lkeF1dKTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfSk7XG4gIHJldHVybiAoY2FsbGJhY2sgPyBwcm9taXNlLnRoZW4oY2FsbGJhY2spIDogcHJvbWlzZSk7XG59O1xuIiwiaW1wb3J0IHsgZ2V0U3RvcmFnZSwgc2V0U3RvcmFnZSwgZ2V0U3RvcmFnZUFsbCB9IGZyb20gXCIuLi9tb2R1bGVzL3N0b3JhZ2VcIjtcbmltcG9ydCB7IFlUX1JFR0VYLCBWSURfUExfUkVHRVggfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyB2aWRPclBMIH0gZnJvbSBcIi4uL3V0aWxcIjtcblxuLy8gY2hyb21lLnN0b3JhZ2Uuc3luYy5jbGVhcigoKSA9PiBjb25zb2xlLmxvZyhcImNsZWFyZWRcIikpO1xuXG5jaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24ocmVxdWVzdCwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpIHtcbiAgY29uc3QgdGFiSWQgPSBzZW5kZXIudGFiLmlkLFxuICAgIHVybCA9IHNlbmRlci50YWIudXJsO1xuICBzd2l0Y2gocmVxdWVzdC5hY3Rpb24pIHtcbiAgICBjYXNlICdzaG93UGFnZUFjdGlvbic6IHtcbiAgICAgIC8vIG5lZWQgdG8gdHVybiBpdCBvZmYgd2hlbiBuYXZpZ2F0aW5nIHRvIG5vbiB2YWxpZCBwYWdlLCBtYXliZSBpbiBvbiB0YWJzIHVwZGF0ZWRcbiAgICAgIGNocm9tZS50YWJzLnF1ZXJ5KHthY3RpdmU6IHRydWUsIGN1cnJlbnRXaW5kb3c6IHRydWV9LCBmdW5jdGlvbih0YWJzKSB7XG4gICAgICAgIGlmICh0YWJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBpc1ZpZE9yUGwgPSB2aWRPclBMKHRhYnNbMF0udXJsKTtcbiAgICAgICAgICBpZiAoaXNWaWRPclBsLmlzUEwgfHwgaXNWaWRPclBsLmlzVmlkKSB7XG4gICAgICAgICAgICBjaHJvbWUucGFnZUFjdGlvbi5zaG93KHRhYnNbMF0uaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zdCBpc1ZpZE9yUGwgPSB2aWRPclBMKHVybCk7XG4gICAgICBpZiAoaXNWaWRPclBsLmlzUEwgfHwgaXNWaWRPclBsLmlzVmlkKSB7XG4gICAgICAgIGNocm9tZS5wYWdlQWN0aW9uLnNob3codGFiSWQpO1xuICAgICAgfVxuXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSAnZ2V0U3RhdGUnOiB7XG4gICAgICBnZXRTdG9yYWdlKCdzZXR0aW5ncycsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEuc2V0dGluZ3MuZW5hYmxlQ29udGVudEJsb2NraW5nKSB7XG4gICAgICAgICAgICBibG9ja0NvbnRlbnQodGFiSWQsIHVybCwgZGF0YS5zZXR0aW5ncy5hbGxvd2VkVmlkZW9zLCBkYXRhLnNldHRpbmdzLmFsbG93ZWRQbGF5bGlzdHMpO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2VJbmZvTXNnKHRhYklkLCB1cmwsIGRhdGEuc2V0dGluZ3MuYWxsb3dlZFZpZGVvcywgZGF0YS5zZXR0aW5ncy5hbGxvd2VkUGxheWxpc3RzKTtcbiAgICAgICAgWydoaWRlUmVsYXRlZCcsICdoaWRlQ29tbWVudHMnLCAnaGlkZUVuZFNjcmVlbiddLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgICAgIHNlbmRTdGF0ZVRvQ29udGVudChkYXRhLnNldHRpbmdzW2ZpZWxkXSwgZmllbGQsIHRhYklkKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICAvL2ZpZ3VyZSBvdXQgaG93IHRvIGRlYWwgd2l0aCBpbmNvbWluZyBtZXNzYWdlIHdpdGggeXRJbmZvIGZyb20gd2luZG93XG4gICAgY2FzZSAncmVjZWl2ZVN0b3JhZ2VJbmZvJzoge1xuICAgICAgY29uc3QgeyB1cmwsIHR5cGUsIHZpZEluZm8sIHBsSW5mbywgaW5mbyB9ID0gcmVxdWVzdDtcbiAgICAgIGNvbnN0IHsgaXNQTCwgUGxJRCwgaXNWaWQsIHZpZElEIH0gPSB2aWRPclBMKHVybCk7XG4gICAgICAgIGdldFN0b3JhZ2UoWydwbFN0b3JhZ2UnLCAndmlkZW9TdG9yYWdlJ10sIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICBsZXQgeyBwbFN0b3JhZ2UsIHZpZGVvU3RvcmFnZSB9ID0gZGF0YTtcbiAgICAgICAgICBzd2l0Y2godHlwZSkge1xuICAgICAgICAgICAgY2FzZSAncmVjZWl2ZVBMJzoge1xuICAgICAgICAgICAgICBsZXQgbmV3UExTdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgcGxTdG9yYWdlKTtcbiAgICAgICAgICAgICAgbmV3UExTdG9yYWdlW1BsSURdID0gbmV3UExTdG9yYWdlW1BsSURdIHx8IHt9O1xuICAgICAgICAgICAgICBuZXdQTFN0b3JhZ2VbUGxJRF0gPSBPYmplY3QuYXNzaWduKHt9LCBwbFN0b3JhZ2VbUGxJRF0sIGluZm8pO1xuICAgICAgICAgICAgICBzZXRTdG9yYWdlKCdwbFN0b3JhZ2UnLCB7IHBsU3RvcmFnZTogbmV3UExTdG9yYWdlIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ3JlY2VpdmVQTDInOiB7XG4gICAgICAgICAgICAgIGxldCBuZXdQTFN0b3JhZ2UgPSBPYmplY3QuYXNzaWduKHt9LCBwbFN0b3JhZ2UpO1xuICAgICAgICAgICAgICBsZXQgbmV3VmlkZW9TdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgdmlkZW9TdG9yYWdlKTtcbiAgICAgICAgICAgICAgbmV3UExTdG9yYWdlW1BsSURdID0gT2JqZWN0LmFzc2lnbih7fSwgbmV3UExTdG9yYWdlW1BsSURdLCBwbEluZm8pO1xuICAgICAgICAgICAgICBuZXdWaWRlb1N0b3JhZ2VbdmlkSURdID0gT2JqZWN0LmFzc2lnbih7fSwgbmV3VmlkZW9TdG9yYWdlW3ZpZElEXSwgdmlkSW5mbyk7XG4gICAgICAgICAgICAgIHNldFN0b3JhZ2UoJ3BsU3RvcmFnZScsIHsgcGxTdG9yYWdlOiBuZXdQTFN0b3JhZ2UgfSk7XG4gICAgICAgICAgICAgIHNldFN0b3JhZ2UoJ3ZpZGVvU3RvcmFnZScsIHsgdmlkZW9TdG9yYWdlOiBuZXdWaWRlb1N0b3JhZ2UgfSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAncmVjZWl2ZVZpZGVvJzoge1xuICAgICAgICAgICAgICBsZXQgbmV3VmlkZW9TdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgdmlkZW9TdG9yYWdlKTtcbiAgICAgICAgICAgICAgbmV3VmlkZW9TdG9yYWdlW3ZpZElEXSA9IG5ld1ZpZGVvU3RvcmFnZVt2aWRJRF0gfHwge307XG4gICAgICAgICAgICAgIG5ld1ZpZGVvU3RvcmFnZVt2aWRJRF0gPSBPYmplY3QuYXNzaWduKHt9LCB2aWRlb1N0b3JhZ2VbdmlkSURdLCBpbmZvKTtcbiAgICAgICAgICAgICAgc2V0U3RvcmFnZSgndmlkZW9TdG9yYWdlJywgeyB2aWRlb1N0b3JhZ2U6IG5ld1ZpZGVvU3RvcmFnZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgJ2xvZyc6IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcXVlc3QpO1xuICAgIH1cbiAgfVxufSk7XG5cbmNocm9tZS50YWJzLnF1ZXJ5KHt9LCBmdW5jdGlvbih0YWJzKSB7XG4gIGNvbnN0IHJlZ2V4ID0gL2h0dHBzOlxcL1xcL3d3dy55b3V0dWJlLmNvbVxcLyovO1xuICBjb25zdCB5dFRhYnMgPSBBcnJheS5mcm9tKHRhYnMpXG4gIC5maWx0ZXIodGFiID0+IHJlZ2V4LnRlc3QodGFiLnVybCkpO1xuICB5dFRhYnMuZm9yRWFjaCh0YWIgPT4ge1xuICAgIGNocm9tZS5wYWdlQWN0aW9uLnNob3codGFiLmlkKTtcbiAgfSk7XG59KTtcblxuKGZ1bmN0aW9uKCkge1xuICBnZXRTdG9yYWdlQWxsKFsnc2V0dGluZ3MnLCAndmlkZW9TdG9yYWdlJywgJ3BsU3RvcmFnZSddKVxuICAudGhlbihkYXRhID0+IHtcbiAgICBlbnN1cmVTZXR0aW5ncyhkYXRhLCAobmV3RGF0YSkgPT4ge1xuICAgICAgaWYgKG5ld0RhdGEuc2V0dGluZ3MuZW5hYmxlQ29udGVudEJsb2NraW5nKSB7XG4gICAgICAgIGNocm9tZS50YWJzLnF1ZXJ5KHt9LCBmdW5jdGlvbih0YWJzKSB7XG4gICAgICAgICAgY29uc3QgcmVnZXggPSAvaHR0cHM6XFwvXFwvd3d3LnlvdXR1YmUuY29tXFwvKi87XG4gICAgICAgICAgY29uc3QgeXRUYWJzID0gQXJyYXkuZnJvbSh0YWJzKVxuICAgICAgICAgIC5maWx0ZXIodGFiID0+IHJlZ2V4LnRlc3QodGFiLnVybCkpO1xuICAgICAgICAgIHl0VGFicy5mb3JFYWNoKHRhYiA9PiB7XG4gICAgICAgICAgICBibG9ja0NvbnRlbnQodGFiLmlkLCB0YWIudXJsLCBuZXdEYXRhLnNldHRpbmdzLmFsbG93ZWRWaWRlb3MsIG5ld0RhdGEuc2V0dGluZ3MuYWxsb3dlZFBsYXlsaXN0cyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgWydoaWRlUmVsYXRlZCcsICdoaWRlQ29tbWVudHMnLCAnaGlkZUVuZFNjcmVlbiddLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgICBzZW5kU3RhdGVUb0NvbnRlbnQobmV3RGF0YS5zZXR0aW5nc1tmaWVsZF0sIGZpZWxkKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbmNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbih0YWJJZCwgY2hhbmdlSW5mbykge1xuICBpZiAoY2hhbmdlSW5mby51cmwgJiYgWVRfUkVHRVgudGVzdChjaGFuZ2VJbmZvLnVybCkpIHtcbiAgICAvLyBtYWtlIHN1cmUgdGhlIHBvcCB1cCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgdGhlIGNvcnJlY3QgcGFnZXNcbiAgICBjb25zdCBpbmZvID0gdmlkT3JQTChjaGFuZ2VJbmZvLnVybCk7XG4gICAgaWYgKGluZm8uaXNQTCB8fCBpbmZvLmlzVmlkKSB7XG4gICAgICBjaHJvbWUucGFnZUFjdGlvbi5zaG93KHRhYklkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hyb21lLnBhZ2VBY3Rpb24uaGlkZSh0YWJJZCk7XG5cbiAgICB9XG4gICAgXG4gICAgY29uc3QgdmlkZW9SZWdleCA9IC9odHRwczpcXC9cXC93d3cueW91dHViZS5jb21cXC93YXRjaCovO1xuICAgIGdldFN0b3JhZ2UoJ3NldHRpbmdzJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgaWYgKHZpZGVvUmVnZXgudGVzdChjaGFuZ2VJbmZvLnVybCkpIHtcbiAgICAgICAgWydoaWRlUmVsYXRlZCcsICdoaWRlQ29tbWVudHMnLCAnaGlkZUVuZFNjcmVlbiddLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKCB0YWJJZCwgeyBhY3Rpb246ICdoaWRlRmllbGQnLCB2YWx1ZTogZGF0YS5zZXR0aW5nc1tmaWVsZF0sIGZpZWxkIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZVN0b3JhZ2VJbmZvTXNnKHRhYklkLCBjaGFuZ2VJbmZvLnVybCwgZGF0YS5zZXR0aW5ncy5hbGxvd2VkVmlkZW9zLCBkYXRhLnNldHRpbmdzLmFsbG93ZWRQbGF5bGlzdHMpO1xuXG4gICAgICBpZiAoZGF0YS5zZXR0aW5ncy5lbmFibGVDb250ZW50QmxvY2tpbmcpIHtcbiAgICAgICAgYmxvY2tDb250ZW50KHRhYklkLCBjaGFuZ2VJbmZvLnVybCwgZGF0YS5zZXR0aW5ncy5hbGxvd2VkVmlkZW9zLCBkYXRhLnNldHRpbmdzLmFsbG93ZWRQbGF5bGlzdHMpO1xuICAgICAgfVxuICB9KTtcblxuICB9XG59KTtcblxuXG5jaHJvbWUuc3RvcmFnZS5vbkNoYW5nZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24oY2hhbmdlcywgbmFtZXNwYWNlKSB7XG4gIGlmIChjaGFuZ2VzLnNldHRpbmdzKSB7XG4gICAgY29uc3QgeyBvbGRWYWx1ZSwgbmV3VmFsdWUgfSA9IGNoYW5nZXMuc2V0dGluZ3M7XG4gICAgXG4gICAgaWYgKG9sZFZhbHVlICYmIG5ld1ZhbHVlKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGVuYWJsZUNvbnRlbnRCbG9ja2luZzogb0VuYWJsZUNvbnRlbnRCbG9ja2luZyxcbiAgICAgICAgYWxsb3dlZFZpZGVvczogb0FsbG93ZWRWaWRlb3MsXG4gICAgICAgIGFsbG93ZWRQbGF5bGlzdHM6IG9BbGxvd2VkUGxheWxpc3RzLFxuICAgICAgICBoaWRlRW5kU2NyZWVuOiBvSGlkZUVuZFNjcmVlbixcbiAgICAgICAgaGlkZVJlbGF0ZWQ6IG9IaWRlUmVsYXRlZCxcbiAgICAgICAgaGlkZUNvbW1lbnRzOiBvSGlkZUNvbW1lbnRzXG4gICAgICB9ID0gb2xkVmFsdWU7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGVuYWJsZUNvbnRlbnRCbG9ja2luZzogbkVuYWJsZUNvbnRlbnRCbG9ja2luZyxcbiAgICAgICAgYWxsb3dlZFZpZGVvczogbkFsbG93ZWRWaWRlb3MsXG4gICAgICAgIGFsbG93ZWRQbGF5bGlzdHM6IG5BbGxvd2VkUGxheWxpc3RzLFxuICAgICAgICBoaWRlRW5kU2NyZWVuOiBuSGlkZUVuZFNjcmVlbixcbiAgICAgICAgaGlkZVJlbGF0ZWQ6IG5IaWRlUmVsYXRlZCxcbiAgICAgICAgaGlkZUNvbW1lbnRzOiBuSGlkZUNvbW1lbnRzXG4gICAgICB9ID0gbmV3VmFsdWU7XG4gICAgICBjb25zdCBibG9ja0VuYWJsZWQgPSAhb0VuYWJsZUNvbnRlbnRCbG9ja2luZyAmJiBuRW5hYmxlQ29udGVudEJsb2NraW5nLFxuICAgICAgICAgICAgdmlkUmVtb3ZlZCA9IG9BbGxvd2VkVmlkZW9zLmxlbmd0aCA+IG5BbGxvd2VkVmlkZW9zLmxlbmd0aCxcbiAgICAgICAgICAgIHBsUmVtb3ZlZCA9IG9BbGxvd2VkUGxheWxpc3RzLmxlbmd0aCA+IG5BbGxvd2VkUGxheWxpc3RzLmxlbmd0aCxcbiAgICAgICAgICAgIGJsb2NrVmlkcyA9IChibG9ja0VuYWJsZWQpIHx8IChuRW5hYmxlQ29udGVudEJsb2NraW5nICYmICh2aWRSZW1vdmVkIHx8IHBsUmVtb3ZlZCkpO1xuICAgICAgaWYgKG9IaWRlUmVsYXRlZCAhPT0gbkhpZGVSZWxhdGVkKSB7XG4gICAgICAgIHNlbmRTdGF0ZVRvQ29udGVudChuSGlkZVJlbGF0ZWQsICdoaWRlUmVsYXRlZCcpO1xuICAgICAgfSBlbHNlIGlmIChvSGlkZUNvbW1lbnRzICE9PSBuSGlkZUNvbW1lbnRzKSB7XG4gICAgICAgIHNlbmRTdGF0ZVRvQ29udGVudChuSGlkZUNvbW1lbnRzLCAnaGlkZUNvbW1lbnRzJyk7XG4gICAgICB9IGVsc2UgaWYgKG9IaWRlRW5kU2NyZWVuICE9PSBuSGlkZUVuZFNjcmVlbikge1xuICAgICAgICBzZW5kU3RhdGVUb0NvbnRlbnQobkhpZGVFbmRTY3JlZW4sICdoaWRlRW5kU2NyZWVuJyk7XG4gICAgICB9IGVsc2UgaWYgKGJsb2NrVmlkcykge1xuICAgICAgICBjaHJvbWUudGFicy5xdWVyeSh7fSwgZnVuY3Rpb24odGFicykge1xuICAgICAgICAgIEFycmF5LmZyb20odGFicykuZmlsdGVyKHRhYiA9PiBZVF9SRUdFWC50ZXN0KHRhYi51cmwpKS5mb3JFYWNoKHRhYiA9PiB7XG4gICAgICAgICAgICBibG9ja0NvbnRlbnQodGFiLmlkLCB0YWIudXJsLCBuQWxsb3dlZFZpZGVvcywgbkFsbG93ZWRQbGF5bGlzdHMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBlbnN1cmVTZXR0aW5ncyhkYXRhLCBjYWxsYmFjaykge1xuICBsZXQgcHJldlNldHRpbmdzID0gZGF0YS5zZXR0aW5ncyB8fCB7fTtcbiAgbGV0IHZpZGVvU3RvcmFnZSA9IGRhdGEudmlkZW9TdG9yYWdlIHx8IHt9O1xuICBsZXQgcGxTdG9yYWdlID0gZGF0YS5wbFN0b3JhZ2UgfHwge307XG5cbiAgbGV0IHsgaGlkZVJlbGF0ZWQsIGhpZGVDb21tZW50cywgaGlkZUVuZFNjcmVlbiwgZW5hYmxlQ29udGVudEJsb2NraW5nLCBhbGxvd2VkVmlkZW9zLCBhbGxvd2VkUGxheWxpc3RzIH0gPSBwcmV2U2V0dGluZ3M7XG5cbiAgaGlkZVJlbGF0ZWQgPSBCb29sZWFuKGhpZGVSZWxhdGVkKTtcbiAgaGlkZUNvbW1lbnRzID0gQm9vbGVhbihoaWRlQ29tbWVudHMpO1xuICBoaWRlRW5kU2NyZWVuID0gQm9vbGVhbihoaWRlRW5kU2NyZWVuKTtcbiAgZW5hYmxlQ29udGVudEJsb2NraW5nID0gQm9vbGVhbihlbmFibGVDb250ZW50QmxvY2tpbmcpO1xuICBhbGxvd2VkVmlkZW9zID0gYWxsb3dlZFZpZGVvcyA9PT0gdW5kZWZpbmVkID8gW10gOiBhbGxvd2VkVmlkZW9zO1xuICBhbGxvd2VkUGxheWxpc3RzID0gYWxsb3dlZFBsYXlsaXN0cyA9PT0gdW5kZWZpbmVkID8gW10gOiBhbGxvd2VkUGxheWxpc3RzO1xuICB2aWRlb1N0b3JhZ2UgPSB2aWRlb1N0b3JhZ2UgPT09IHVuZGVmaW5lZCA/IHt9IDogdmlkZW9TdG9yYWdlO1xuICBwbFN0b3JhZ2UgPSBwbFN0b3JhZ2UgPT09IHVuZGVmaW5lZCA/IHt9IDogcGxTdG9yYWdlO1xuICBjb25zdCBzZXR0aW5ncyA9IHsgaGlkZVJlbGF0ZWQsIGhpZGVDb21tZW50cywgaGlkZUVuZFNjcmVlbiwgZW5hYmxlQ29udGVudEJsb2NraW5nLCBhbGxvd2VkVmlkZW9zLCBhbGxvd2VkUGxheWxpc3RzIH07XG4gIC8vdXBkYXRlIHN0b3JhZ2UgdXNlIHRvIG5ldyBzZXQgZnVuY3Rpb25cbiAgbGV0IG5ld0RhdGEgPSB7fTtcbiAgc2V0U3RvcmFnZSgnc2V0dGluZ3MnLCB7IHNldHRpbmdzIH0pLnRoZW4oZGF0YSA9PiB7XG4gICAgbmV3RGF0YSA9IE9iamVjdC5hc3NpZ24obmV3RGF0YSwgZGF0YSk7XG4gICAgcmV0dXJuIHNldFN0b3JhZ2UoJ3BsU3RvcmFnZScsIHsgcGxTdG9yYWdlIH0pO1xuICB9KS50aGVuKGRhdGEgPT4ge1xuICAgIG5ld0RhdGEgPSBPYmplY3QuYXNzaWduKG5ld0RhdGEsIGRhdGEpO1xuICAgIHJldHVybiBzZXRTdG9yYWdlKCd2aWRlb1N0b3JhZ2UnLCB7IHZpZGVvU3RvcmFnZSB9KTtcbiAgfSkudGhlbihkYXRhID0+IHtcbiAgICBuZXdEYXRhID0gT2JqZWN0LmFzc2lnbihuZXdEYXRhLCBkYXRhKTtcbiAgICBjYWxsYmFjayhuZXdEYXRhKTtcbiAgfSk7XG4gIC8vY2hlY2sgdG8gbWFrZXN1cmUgdGhpcyB3b3JrcyFcbn1cblxuZnVuY3Rpb24gdXBkYXRlU3RvcmFnZUluZm9Nc2codGFiSWQsIHVybCwgYWxsb3dlZFZpZGVvcywgYWxsb3dlZFBsYXlsaXN0cykge1xuICBjb25zdCB7IGlzUEwsIFBsSUQsIGlzVmlkLCB2aWRJRCwgbm90WXQgfSA9IHZpZE9yUEwodXJsKTtcbiAgaWYgKCBpc1BMICYmIGlzVmlkKSB7XG4gICAgaWYgKGFsbG93ZWRWaWRlb3MuaW5jbHVkZXModmlkSUQpIHx8IGFsbG93ZWRQbGF5bGlzdHMuaW5jbHVkZXMoUGxJRCkpIHtcbiAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYklkLCB7IGFjdGlvbjogJ2dhdGhlclBMSW5mbzInIH0pO1xuICAgIH1cbiAgfSBlbHNlIGlmIChpc1BMKSB7XG4gICAgaWYgKGFsbG93ZWRQbGF5bGlzdHMuaW5jbHVkZXMoUGxJRCkpIHtcbiAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYklkLCB7IGFjdGlvbjogJ2dhdGhlclBMSW5mbycgfSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGlzVmlkKSB7XG4gICAgaWYgKGFsbG93ZWRWaWRlb3MuaW5jbHVkZXModmlkSUQpKSB7XG4gICAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWJJZCwgeyBhY3Rpb246ICdnYXRoZXJWaWRlb0luZm8nIH0pO1xuICAgIH1cblxuICB9XG59XG5cbmZ1bmN0aW9uIGxvZ1RvQ29udGVudCh0ZXh0KSB7XG4gIGNvbnN0IG1lc3NhZ2UgPSB7IGFjdGlvbjogJ2xvZycsIG1lc3NhZ2U6IHRleHQgfTtcbiAgY2hyb21lLnRhYnMucXVlcnkoe30sIGZ1bmN0aW9uKHRhYnMpIHtcbiAgICBBcnJheS5mcm9tKHRhYnMpXG4gICAgLmZvckVhY2godGFiID0+IGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYi5pZCwgbWVzc2FnZSkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gc2VuZFN0YXRlVG9Db250ZW50KHZhbHVlLCBmaWVsZCwgdGFiSWQpIHtcbiAgdmFyIG1lc3NhZ2UgPSB7IGFjdGlvbjogJ2hpZGVGaWVsZCcsIHZhbHVlLCBmaWVsZCB9O1xuICBpZiAodGFiSWQpIHtcbiAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWJJZCwgbWVzc2FnZSk7XG4gIH1cbiAgY2hyb21lLnRhYnMucXVlcnkoe30sIGZ1bmN0aW9uKHRhYnMpIHtcbiAgICBBcnJheS5mcm9tKHRhYnMpXG4gICAgLmZvckVhY2godGFiID0+IGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYi5pZCwgbWVzc2FnZSkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gYmxvY2tDb250ZW50KHRhYklkLCB1cmwsIGFsbG93ZWRWaWRlb3MsIGFsbG93ZWRQbGF5bGlzdHMpIHtcbiAgY29uc3QgeyBpc1BMLCBQbElELCBpc1ZpZCwgdmlkSUQsIG5vdFl0IH0gPSB2aWRPclBMKHVybCk7XG4gIGNvbnN0IHBhZ2VJc250QWxsb3dlZCA9ICgoKGlzVmlkICYmICFpc1BMKSAmJiAhYWxsb3dlZFZpZGVvcy5pbmNsdWRlcyh2aWRJRCkpIHx8IChpc1BMICYmICFhbGxvd2VkUGxheWxpc3RzLmluY2x1ZGVzKFBsSUQpKSB8fCAoIWlzVmlkICYmICFpc1BMICYmICFub3RZdCkpO1xuICBpZiAocGFnZUlzbnRBbGxvd2VkKSB7XG4gICAgY2hyb21lLnRhYnMudXBkYXRlKHRhYklkLCB7dXJsOiAnbm90X2F2YWlsYWJsZS9ub3RfYXZhaWxhYmxlLmh0bWwnfSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IFZJRF9QTF9SRUdFWCB9IGZyb20gXCIuL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgY29uc3QgdmlkT3JQTCA9ICh1cmwpID0+IHtcbiAgY29uc3QgcmVzID0gdXJsLm1hdGNoKFZJRF9QTF9SRUdFWCk7XG4gIHJldHVybiB7IGlzUEw6IEJvb2xlYW4ocmVzWzFdIHx8IHJlc1s3XSksXG4gICAgICAgICAgIFBsSUQ6IHJlc1syXSB8fCByZXNbOF0sXG4gICAgICAgICAgIGlzVmlkOiBCb29sZWFuKChyZXNbM10gJiYgcmVzWzRdKSksXG4gICAgICAgICAgIHZpZElEOiByZXNbNF0gfTtcbn07XG4iLCJleHBvcnQgY29uc3QgWVRfUkVHRVggPSAvaHR0cHM6XFwvXFwvd3d3LnlvdXR1YmUuY29tXFwvKi87XG5cbmV4cG9ydCBjb25zdCBWSURfUExfUkVHRVggPSAvaHR0cHM6XFwvXFwvd3d3XFwueW91dHViZVxcLmNvbVxcLyhwbGF5bGlzdFxcP2xpc3Q9KC4rKSk/KHdhdGNoXFw/dj0oW0EtWmEtejAtOV8tXXsxMX0pKT8oJnQ9W14mXSspPygmaW5kZXhbXiZdKyk/KCZsaXN0PShbXiZdKyk/KT8oJi4qKT8vO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==