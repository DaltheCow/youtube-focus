!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}({1:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return r}));var o=function(e,t){var n="settings"===e?chrome.storage.sync:chrome.storage.local,o=new Promise((function(t){n.get(e,(function(e){return t(e)}))}));return t?o.then(t):o},i=function(e,t,n){var o="settings"===e?chrome.storage.sync:chrome.storage.local,i=new Promise((function(n){o.set(t,(function(){o.get(e,(function(e){return n(e)}))}))}));return n?i.then(n):i},r=function(e,t){var n=e.map((function(e){return{key:e,storage:chrome.storage["settings"===e?"sync":"local"]}})),o=Promise.all(n.map((function(e){var t=e.storage,n=e.key;return new Promise((function(e){t.get(n,(function(t){return e(t)}))}))}))).then((function(t){var n={};return t.forEach((function(t,o){return n[e[o]]=t[e[o]]})),n}));return t?o.then(t):o}},15:function(e,t,n){"use strict";n.r(t);var o=n(1),i=n(3),r=n(2);function a(e,t,n,o){var i=Object(r.a)(t),a=i.isPL,s=i.PlID,c=i.isVid,l=i.vidID;i.notYt;a&&c?(n.includes(l)||o.includes(s))&&chrome.tabs.sendMessage(e,{action:"gatherPLInfo2"}):a?o.includes(s)&&chrome.tabs.sendMessage(e,{action:"gatherPLInfo"}):c&&n.includes(l)&&chrome.tabs.sendMessage(e,{action:"gatherVideoInfo"})}function s(e,t,n){var o={action:"hideField",value:e,field:t};n&&chrome.tabs.sendMessage(n,o),chrome.tabs.query({},(function(e){Array.from(e).forEach((function(e){return chrome.tabs.sendMessage(e.id,o)}))}))}function c(e,t,n,o){var i=Object(r.a)(t),a=i.isPL,s=i.PlID,c=i.isVid,l=i.vidID,d=i.notYt;(c&&!a&&!n.includes(l)||a&&!o.includes(s)||!c&&!a&&!d)&&chrome.tabs.update(e,{url:"not_available/not_available.html"})}chrome.runtime.onMessage.addListener((function(e,t,n){var i=t.tab.id,l=t.tab.url;switch(e.action){case"showPageAction":chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(e.length>0){var t=Object(r.a)(e[0].url);(t.isPL||t.isVid)&&chrome.pageAction.show(e[0].id)}}));var d=Object(r.a)(l);(d.isPL||d.isVid)&&chrome.pageAction.show(i);break;case"getState":Object(o.a)("settings",(function(e){e.settings.enableContentBlocking&&c(i,l,e.settings.allowedVideos,e.settings.allowedPlaylists),a(i,l,e.settings.allowedVideos,e.settings.allowedPlaylists),["hideRelated","hideComments","hideEndScreen"].forEach((function(t){s(e.settings[t],t,i)}))}));break;case"receiveStorageInfo":var u=e.url,g=e.type,h=e.vidInfo,f=e.plInfo,b=e.info,m=Object(r.a)(u),w=(m.isPL,m.PlID),v=(m.isVid,m.vidID);Object(o.a)(["plStorage","videoStorage"],(function(e){var t=e.plStorage,n=e.videoStorage;switch(g){case"receivePL":var i=Object.assign({},t);i[w]=i[w]||{},i[w]=Object.assign({},t[w],b),Object(o.c)("plStorage",{plStorage:i});break;case"receivePL2":var r=Object.assign({},t),a=Object.assign({},n);r[w]=Object.assign({},r[w],f),a[v]=Object.assign({},a[v],h),Object(o.c)("plStorage",{plStorage:r}),Object(o.c)("videoStorage",{videoStorage:a});break;case"receiveVideo":var s=Object.assign({},n);s[v]=s[v]||{},s[v]=Object.assign({},n[v],b),Object(o.c)("videoStorage",{videoStorage:s})}}));break;case"log":console.log(e)}})),chrome.contextMenus.create({title:"Add Playlist",contexts:["page"],id:"plPage",documentUrlPatterns:["https://www.youtube.com/playlist*","https://www.youtube.com/watch*list=*"]}),chrome.contextMenus.create({title:"Add Video",contexts:["page"],id:"videoPage",documentUrlPatterns:["https://www.youtube.com/watch*"]}),chrome.contextMenus.create({title:"Add Video",contexts:["link"],id:"videoLink",targetUrlPatterns:["https://www.youtube.com/watch*"]}),chrome.contextMenus.create({title:"Add Playlist",contexts:["link"],id:"plLink",targetUrlPatterns:["https://www.youtube.com/playlist*","https://www.youtube.com/watch*list=*"]}),chrome.contextMenus.onClicked.addListener((function(e,t){var n=e.linkUrl||e.pageUrl;Object(o.a)("settings",(function(o){var i=o.settings,a=i.allowedVideos,s=i.allowedPlaylists,c=Object(r.a)(n),l=c.isPL,d=c.PlID,u=c.isVid,g=c.vidID;if(l&&!s.includes(d)&&(s=s.concat(d)),l||!u||a.includes(g)||(a=a.concat(g)),l||u){var h,f=Object.assign({},o.settings,{allowedVideos:a,allowedPlaylists:s});chrome.storage.sync.set({settings:f}),e.linkUrl?(h="getTitle",chrome.tabs.sendMessage(t.id,{action:h,targetUrl:n})):(h=l&&u?"gatherPLInfo2":l?"gatherPLInfo":"gatherVideoInfo",chrome.tabs.sendMessage(t.id,{action:h}))}}))})),chrome.tabs.query({},(function(e){var t=/https:\/\/www.youtube.com\/*/;Array.from(e).filter((function(e){return t.test(e.url)})).forEach((function(e){chrome.pageAction.show(e.id)}))})),Object(o.b)(["settings","videoStorage","plStorage"]).then((function(e){!function(e,t){var n=e.settings||{},i=e.videoStorage||{},r=e.plStorage||{},a=n.hideRelated,s=n.hideComments,c=n.hideEndScreen,l=n.enableContentBlocking,d=n.allowedVideos,u=n.allowedPlaylists;a=Boolean(a),s=Boolean(s),c=Boolean(c),l=Boolean(l),i=void 0===i?{}:i,r=void 0===r?{}:r;var g={hideRelated:a,hideComments:s,hideEndScreen:c,enableContentBlocking:l,allowedVideos:d=void 0===d?[]:d,allowedPlaylists:u=void 0===u?[]:u},h={};Object(o.c)("settings",{settings:g}).then((function(e){return h=Object.assign(h,e),Object(o.c)("plStorage",{plStorage:r})})).then((function(e){return h=Object.assign(h,e),Object(o.c)("videoStorage",{videoStorage:i})})).then((function(e){h=Object.assign(h,e),t(h)}))}(e,(function(e){e.settings.enableContentBlocking&&chrome.tabs.query({},(function(t){var n=/https:\/\/www.youtube.com\/*/;Array.from(t).filter((function(e){return n.test(e.url)})).forEach((function(t){c(t.id,t.url,e.settings.allowedVideos,e.settings.allowedPlaylists)}))})),["hideRelated","hideComments","hideEndScreen"].forEach((function(t){s(e.settings[t],t)}))}))})),chrome.tabs.onUpdated.addListener((function(e,t){if(t.url&&i.b.test(t.url)){var n=Object(r.a)(t.url);n.isPL||n.isVid?chrome.pageAction.show(e):chrome.pageAction.hide(e);var s=/https:\/\/www.youtube.com\/watch*/;Object(o.a)("settings",(function(n){s.test(t.url)&&["hideRelated","hideComments","hideEndScreen"].forEach((function(t){chrome.tabs.sendMessage(e,{action:"hideField",value:n.settings[t],field:t})})),a(e,t.url,n.settings.allowedVideos,n.settings.allowedPlaylists),n.settings.enableContentBlocking&&c(e,t.url,n.settings.allowedVideos,n.settings.allowedPlaylists)}))}})),chrome.storage.onChanged.addListener((function(e,t){if(e.settings){var n=e.settings,o=n.oldValue,r=n.newValue;if(o&&r){var a=o.enableContentBlocking,l=o.allowedVideos,d=o.allowedPlaylists,u=o.hideEndScreen,g=o.hideRelated,h=o.hideComments,f=r.enableContentBlocking,b=r.allowedVideos,m=r.allowedPlaylists,w=r.hideEndScreen,v=r.hideRelated,p=r.hideComments,y=!a&&f,P=l.length>b.length,j=d.length>m.length,O=y||f&&(P||j);g!==v?s(v,"hideRelated"):h!==p?s(p,"hideComments"):u!==w?s(w,"hideEndScreen"):O&&chrome.tabs.query({},(function(e){Array.from(e).filter((function(e){return i.b.test(e.url)})).forEach((function(e){c(e.id,e.url,b,m)}))}))}}}))},2:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(3),i=function(e){var t=e.match(o.a);return{isPL:Boolean(t[1]||t[7]),PlID:t[2]||t[8],isVid:Boolean(t[3]&&t[4]),vidID:t[4]}}},3:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var o=/https:\/\/www.youtube.com\/*/,i=/https:\/\/www\.youtube\.com\/(playlist\?list=(.+))?(watch\?v=([A-Za-z0-9_-]{11}))?(&t=[^&]+)?(&index[^&]+)?(&list=([^&]+)?)?(&.*)?/}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9zdG9yYWdlLmpzIiwid2VicGFjazovLy8uL2JhY2tncm91bmQvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vdXRpbC5qcyIsIndlYnBhY2s6Ly8vLi9jb25zdGFudHMuanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJnZXRTdG9yYWdlIiwiY2FsbGJhY2siLCJzdG9yYWdlIiwiY2hyb21lIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0U3RvcmFnZSIsImRhdGEiLCJnZXRTdG9yYWdlQWxsIiwia2V5cyIsInN0b3JhZ2VzS2V5cyIsInN0b3JhZ2VLZXkiLCJyZXMiLCJpdGVtIiwidXBkYXRlU3RvcmFnZUluZm9Nc2ciLCJ0YWJJZCIsInVybCIsImFsbG93ZWRWaWRlb3MiLCJhbGxvd2VkUGxheWxpc3RzIiwidmlkT3JQTCIsImlzUEwiLCJQbElEIiwiaXNWaWQiLCJ2aWRJRCIsImFjdGlvbiIsInNlbmRTdGF0ZVRvQ29udGVudCIsImZpZWxkIiwibWVzc2FnZSIsIkFycmF5IiwidGFiIiwiYmxvY2tDb250ZW50Iiwibm90WXQiLCJzZW5kZXIiLCJyZXF1ZXN0IiwiYWN0aXZlIiwiY3VycmVudFdpbmRvdyIsInRhYnMiLCJpc1ZpZE9yUGwiLCJ0eXBlIiwidmlkSW5mbyIsInBsSW5mbyIsImluZm8iLCJwbFN0b3JhZ2UiLCJ2aWRlb1N0b3JhZ2UiLCJuZXdQTFN0b3JhZ2UiLCJuZXdWaWRlb1N0b3JhZ2UiLCJjb25zb2xlIiwiZSIsInNldHRpbmdzIiwidGFyZ2V0VXJsIiwicmVnZXgiLCJ5dFRhYnMiLCJwcmV2U2V0dGluZ3MiLCJoaWRlUmVsYXRlZCIsImhpZGVDb21tZW50cyIsImhpZGVFbmRTY3JlZW4iLCJlbmFibGVDb250ZW50QmxvY2tpbmciLCJCb29sZWFuIiwibmV3RGF0YSIsImVuc3VyZVNldHRpbmdzIiwiY2hhbmdlSW5mbyIsIllUX1JFR0VYIiwidmlkZW9SZWdleCIsImNoYW5nZXMiLCJvbGRWYWx1ZSIsIm5ld1ZhbHVlIiwib0VuYWJsZUNvbnRlbnRCbG9ja2luZyIsIm9BbGxvd2VkVmlkZW9zIiwib0FsbG93ZWRQbGF5bGlzdHMiLCJvSGlkZUVuZFNjcmVlbiIsIm9IaWRlUmVsYXRlZCIsIm9IaWRlQ29tbWVudHMiLCJuRW5hYmxlQ29udGVudEJsb2NraW5nIiwibkFsbG93ZWRWaWRlb3MiLCJuQWxsb3dlZFBsYXlsaXN0cyIsIm5IaWRlRW5kU2NyZWVuIiwibkhpZGVSZWxhdGVkIiwibkhpZGVDb21tZW50cyIsImJsb2NrRW5hYmxlZCIsInZpZFJlbW92ZWQiLCJwbFJlbW92ZWQiLCJibG9ja1ZpZHMiLCJWSURfUExfUkVHRVgiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixF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cEIwQixzQkFBd0IsU0FBQUMsR0FBRyxPQUFJZ0MsU0FBY2hDLEVBQWxCLFFBQTNCRCxTQUErRCxTQUFBQyxHQUM3REMsRUFBYUQsRUFBRCxHQUFTQSxFQUFULE1BQVpDLGUsK0JDNU9aLDZDQUVhWCxFQUFVLFNBQUNILEdBQ3RCLElBQU1KLEVBQU1JLFFBQVosS0FDQSxNQUFPLENBQUVJLEtBQU1xQyxRQUFRN0MsTUFBVUEsRUFBMUIsSUFDRVMsS0FBTVQsTUFBVUEsRUFEbEIsR0FFRVUsTUFBT21DLFFBQVM3QyxNQUFVQSxFQUY1QixJQUdFVyxNQUFPWCxFQUFJLE0sK0JDUHRCLG9FQUFPLElBQU1pRCxFQUFOLCtCQUVNcUIsRUFBTiIsImZpbGUiOiJiYWNrZ3JvdW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDE1KTtcbiIsImV4cG9ydCBjb25zdCBnZXRTdG9yYWdlID0gKGtleSwgY2FsbGJhY2spID0+IHtcbiAgY29uc3Qgc3RvcmFnZSA9IChrZXkgPT09ICdzZXR0aW5ncycgPyBjaHJvbWUuc3RvcmFnZS5zeW5jIDogY2hyb21lLnN0b3JhZ2UubG9jYWwpO1xuICBsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIHN0b3JhZ2UuZ2V0KGtleSwgKGRhdGEpID0+IHJlc29sdmUoZGF0YSkpO1xuICB9KTtcbiAgcmV0dXJuIChjYWxsYmFjayA/IHByb21pc2UudGhlbihjYWxsYmFjaykgOiBwcm9taXNlKTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZXRTdG9yYWdlID0gKGtleSwgb2JqZWN0LCBjYWxsYmFjaykgPT4ge1xuICBjb25zdCBzdG9yYWdlID0gKGtleSA9PT0gJ3NldHRpbmdzJyA/IGNocm9tZS5zdG9yYWdlLnN5bmMgOiBjaHJvbWUuc3RvcmFnZS5sb2NhbCk7XG4gIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgc3RvcmFnZS5zZXQob2JqZWN0LCAoKSA9PiB7XG4gICAgICBzdG9yYWdlLmdldChrZXksIGRhdGEgPT4ge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZShkYXRhKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIChjYWxsYmFjayA/IHByb21pc2UudGhlbihjYWxsYmFjaykgOiBwcm9taXNlKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRTdG9yYWdlQWxsID0gKGtleXMsIGNhbGxiYWNrKSA9PiB7XG4gIGNvbnN0IHN0b3JhZ2VzS2V5cyA9IGtleXMubWFwKGtleSA9PiB7XG4gICAgcmV0dXJuIHsga2V5LCBzdG9yYWdlOiBjaHJvbWUuc3RvcmFnZVsoa2V5ID09PSAnc2V0dGluZ3MnID8gJ3N5bmMnIDogJ2xvY2FsJyldIH07XG4gIH0pO1xuICBsZXQgcHJvbWlzZSA9IFByb21pc2UuYWxsKHN0b3JhZ2VzS2V5cy5tYXAoc3RvcmFnZUtleSA9PiB7XG4gICAgY29uc3QgeyBzdG9yYWdlLCBrZXkgfSA9IHN0b3JhZ2VLZXk7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgc3RvcmFnZS5nZXQoa2V5LCAoZGF0YSkgPT4gcmVzb2x2ZShkYXRhKSk7XG4gICAgfSk7XG4gIH0pKS50aGVuKHJlcyA9PiB7XG4gICAgY29uc3QgZGF0YSA9IHt9O1xuICAgIHJlcy5mb3JFYWNoKChpdGVtLCBpZHgpID0+IGRhdGFba2V5c1tpZHhdXSA9IGl0ZW1ba2V5c1tpZHhdXSk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH0pO1xuICByZXR1cm4gKGNhbGxiYWNrID8gcHJvbWlzZS50aGVuKGNhbGxiYWNrKSA6IHByb21pc2UpO1xufTtcbiIsImltcG9ydCB7IGdldFN0b3JhZ2UsIHNldFN0b3JhZ2UsIGdldFN0b3JhZ2VBbGwgfSBmcm9tIFwiLi4vbW9kdWxlcy9zdG9yYWdlXCI7XG5pbXBvcnQgeyBZVF9SRUdFWCwgVklEX1BMX1JFR0VYIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgdmlkT3JQTCB9IGZyb20gXCIuLi91dGlsXCI7XG5cbi8vIGNocm9tZS5zdG9yYWdlLnN5bmMuY2xlYXIoKCkgPT4gY29uc29sZS5sb2coXCJjbGVhcmVkXCIpKTtcbi8vIGNocm9tZS5jb250ZXh0TWVudXMuY3JlYXRlKHtcbi8vICAgdGl0bGU6IFwiWW91IHNlZWluIHRoaXM/XCIsXG4vLyAgIGNvbnRleHRzOiBbXCJhbGxcIl0sXG4vLyAgIG9uY2xpY2s6ICgpID0+IGFsZXJ0KCdoaScpXG4vLyB9KTtcblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uKHJlcXVlc3QsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSB7XG4gIGNvbnN0IHRhYklkID0gc2VuZGVyLnRhYi5pZCxcbiAgICB1cmwgPSBzZW5kZXIudGFiLnVybDtcbiAgc3dpdGNoKHJlcXVlc3QuYWN0aW9uKSB7XG4gICAgY2FzZSAnc2hvd1BhZ2VBY3Rpb24nOiB7XG4gICAgICAvLyBuZWVkIHRvIHR1cm4gaXQgb2ZmIHdoZW4gbmF2aWdhdGluZyB0byBub24gdmFsaWQgcGFnZSwgbWF5YmUgaW4gb24gdGFicyB1cGRhdGVkXG4gICAgICBjaHJvbWUudGFicy5xdWVyeSh7YWN0aXZlOiB0cnVlLCBjdXJyZW50V2luZG93OiB0cnVlfSwgZnVuY3Rpb24odGFicykge1xuICAgICAgICBpZiAodGFicy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgaXNWaWRPclBsID0gdmlkT3JQTCh0YWJzWzBdLnVybCk7XG4gICAgICAgICAgaWYgKGlzVmlkT3JQbC5pc1BMIHx8IGlzVmlkT3JQbC5pc1ZpZCkge1xuICAgICAgICAgICAgY2hyb21lLnBhZ2VBY3Rpb24uc2hvdyh0YWJzWzBdLmlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgY29uc3QgaXNWaWRPclBsID0gdmlkT3JQTCh1cmwpO1xuICAgICAgaWYgKGlzVmlkT3JQbC5pc1BMIHx8IGlzVmlkT3JQbC5pc1ZpZCkge1xuICAgICAgICBjaHJvbWUucGFnZUFjdGlvbi5zaG93KHRhYklkKTtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgJ2dldFN0YXRlJzoge1xuICAgICAgZ2V0U3RvcmFnZSgnc2V0dGluZ3MnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLnNldHRpbmdzLmVuYWJsZUNvbnRlbnRCbG9ja2luZykge1xuICAgICAgICAgICAgYmxvY2tDb250ZW50KHRhYklkLCB1cmwsIGRhdGEuc2V0dGluZ3MuYWxsb3dlZFZpZGVvcywgZGF0YS5zZXR0aW5ncy5hbGxvd2VkUGxheWxpc3RzKTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVTdG9yYWdlSW5mb01zZyh0YWJJZCwgdXJsLCBkYXRhLnNldHRpbmdzLmFsbG93ZWRWaWRlb3MsIGRhdGEuc2V0dGluZ3MuYWxsb3dlZFBsYXlsaXN0cyk7XG4gICAgICAgIFsnaGlkZVJlbGF0ZWQnLCAnaGlkZUNvbW1lbnRzJywgJ2hpZGVFbmRTY3JlZW4nXS5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgICBzZW5kU3RhdGVUb0NvbnRlbnQoZGF0YS5zZXR0aW5nc1tmaWVsZF0sIGZpZWxkLCB0YWJJZCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgLy9maWd1cmUgb3V0IGhvdyB0byBkZWFsIHdpdGggaW5jb21pbmcgbWVzc2FnZSB3aXRoIHl0SW5mbyBmcm9tIHdpbmRvd1xuICAgIGNhc2UgJ3JlY2VpdmVTdG9yYWdlSW5mbyc6IHtcbiAgICAgIGNvbnN0IHsgdXJsLCB0eXBlLCB2aWRJbmZvLCBwbEluZm8sIGluZm8gfSA9IHJlcXVlc3Q7XG4gICAgICBjb25zdCB7IGlzUEwsIFBsSUQsIGlzVmlkLCB2aWRJRCB9ID0gdmlkT3JQTCh1cmwpO1xuICAgICAgICBnZXRTdG9yYWdlKFsncGxTdG9yYWdlJywgJ3ZpZGVvU3RvcmFnZSddLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgbGV0IHsgcGxTdG9yYWdlLCB2aWRlb1N0b3JhZ2UgfSA9IGRhdGE7XG4gICAgICAgICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3JlY2VpdmVQTCc6IHtcbiAgICAgICAgICAgICAgbGV0IG5ld1BMU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIHBsU3RvcmFnZSk7XG4gICAgICAgICAgICAgIG5ld1BMU3RvcmFnZVtQbElEXSA9IG5ld1BMU3RvcmFnZVtQbElEXSB8fCB7fTtcbiAgICAgICAgICAgICAgbmV3UExTdG9yYWdlW1BsSURdID0gT2JqZWN0LmFzc2lnbih7fSwgcGxTdG9yYWdlW1BsSURdLCBpbmZvKTtcbiAgICAgICAgICAgICAgc2V0U3RvcmFnZSgncGxTdG9yYWdlJywgeyBwbFN0b3JhZ2U6IG5ld1BMU3RvcmFnZSB9KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdyZWNlaXZlUEwyJzoge1xuICAgICAgICAgICAgICBsZXQgbmV3UExTdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgcGxTdG9yYWdlKTtcbiAgICAgICAgICAgICAgbGV0IG5ld1ZpZGVvU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIHZpZGVvU3RvcmFnZSk7XG4gICAgICAgICAgICAgIG5ld1BMU3RvcmFnZVtQbElEXSA9IE9iamVjdC5hc3NpZ24oe30sIG5ld1BMU3RvcmFnZVtQbElEXSwgcGxJbmZvKTtcbiAgICAgICAgICAgICAgbmV3VmlkZW9TdG9yYWdlW3ZpZElEXSA9IE9iamVjdC5hc3NpZ24oe30sIG5ld1ZpZGVvU3RvcmFnZVt2aWRJRF0sIHZpZEluZm8pO1xuICAgICAgICAgICAgICBzZXRTdG9yYWdlKCdwbFN0b3JhZ2UnLCB7IHBsU3RvcmFnZTogbmV3UExTdG9yYWdlIH0pO1xuICAgICAgICAgICAgICBzZXRTdG9yYWdlKCd2aWRlb1N0b3JhZ2UnLCB7IHZpZGVvU3RvcmFnZTogbmV3VmlkZW9TdG9yYWdlIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ3JlY2VpdmVWaWRlbyc6IHtcbiAgICAgICAgICAgICAgbGV0IG5ld1ZpZGVvU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIHZpZGVvU3RvcmFnZSk7XG4gICAgICAgICAgICAgIG5ld1ZpZGVvU3RvcmFnZVt2aWRJRF0gPSBuZXdWaWRlb1N0b3JhZ2VbdmlkSURdIHx8IHt9O1xuICAgICAgICAgICAgICBuZXdWaWRlb1N0b3JhZ2VbdmlkSURdID0gT2JqZWN0LmFzc2lnbih7fSwgdmlkZW9TdG9yYWdlW3ZpZElEXSwgaW5mbyk7XG4gICAgICAgICAgICAgIHNldFN0b3JhZ2UoJ3ZpZGVvU3RvcmFnZScsIHsgdmlkZW9TdG9yYWdlOiBuZXdWaWRlb1N0b3JhZ2UgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlICdsb2cnOiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXF1ZXN0KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5jaHJvbWUuY29udGV4dE1lbnVzLmNyZWF0ZSh7XG4gIFwidGl0bGVcIjogXCJBZGQgUGxheWxpc3RcIixcbiAgXCJjb250ZXh0c1wiOiBbXCJwYWdlXCJdLFxuICBcImlkXCI6IFwicGxQYWdlXCIsXG4gIFwiZG9jdW1lbnRVcmxQYXR0ZXJuc1wiOiBbXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9wbGF5bGlzdCpcIiwgXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaCpsaXN0PSpcIl1cbn0pO1xuY2hyb21lLmNvbnRleHRNZW51cy5jcmVhdGUoe1xuICBcInRpdGxlXCI6IFwiQWRkIFZpZGVvXCIsXG4gIFwiY29udGV4dHNcIjogW1wicGFnZVwiXSxcbiAgXCJpZFwiOiBcInZpZGVvUGFnZVwiLFxuICBcImRvY3VtZW50VXJsUGF0dGVybnNcIjogW1wiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2gqXCJdXG59KTtcbmNocm9tZS5jb250ZXh0TWVudXMuY3JlYXRlKHtcbiAgXCJ0aXRsZVwiOiBcIkFkZCBWaWRlb1wiLFxuICBcImNvbnRleHRzXCI6IFtcImxpbmtcIl0sXG4gIFwiaWRcIjogXCJ2aWRlb0xpbmtcIixcbiAgXCJ0YXJnZXRVcmxQYXR0ZXJuc1wiOiBbXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaCpcIl1cbn0pO1xuY2hyb21lLmNvbnRleHRNZW51cy5jcmVhdGUoe1xuICBcInRpdGxlXCI6IFwiQWRkIFBsYXlsaXN0XCIsXG4gIFwiY29udGV4dHNcIjogW1wibGlua1wiXSxcbiAgXCJpZFwiOiBcInBsTGlua1wiLFxuICBcInRhcmdldFVybFBhdHRlcm5zXCI6IFtcImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3BsYXlsaXN0KlwiLCBcImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoKmxpc3Q9KlwiXVxufSk7XG5cbmNocm9tZS5jb250ZXh0TWVudXMub25DbGlja2VkLmFkZExpc3RlbmVyKGFkZFZpZE9yUGwpO1xuXG5mdW5jdGlvbiBhZGRWaWRPclBsKGUsIHRhYikge1xuICBsZXQgdXJsID0gZS5saW5rVXJsIHx8IGUucGFnZVVybDtcbiAgZ2V0U3RvcmFnZSgnc2V0dGluZ3MnLCBkYXRhID0+IHtcbiAgICBsZXQgeyBhbGxvd2VkVmlkZW9zLCBhbGxvd2VkUGxheWxpc3RzIH0gPSBkYXRhLnNldHRpbmdzO1xuICAgIFxuICAgIGNvbnN0IHsgaXNQTCwgUGxJRCwgaXNWaWQsIHZpZElEIH0gPSB2aWRPclBMKHVybCk7XG5cbiAgICBpZiAoaXNQTCAmJiAhYWxsb3dlZFBsYXlsaXN0cy5pbmNsdWRlcyhQbElEKSkge1xuICAgICAgYWxsb3dlZFBsYXlsaXN0cyA9IGFsbG93ZWRQbGF5bGlzdHMuY29uY2F0KFBsSUQpO1xuICAgIH1cbiAgICBpZiAoIWlzUEwgJiYgaXNWaWQgJiYgIWFsbG93ZWRWaWRlb3MuaW5jbHVkZXModmlkSUQpKSB7XG4gICAgICBhbGxvd2VkVmlkZW9zID0gYWxsb3dlZFZpZGVvcy5jb25jYXQodmlkSUQpO1xuICAgIH1cbiAgICBpZiAoaXNQTCB8fCBpc1ZpZCkge1xuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhLnNldHRpbmdzLCB7IGFsbG93ZWRWaWRlb3MsIGFsbG93ZWRQbGF5bGlzdHMgfSk7XG4gICAgICBjaHJvbWUuc3RvcmFnZS5zeW5jLnNldCh7IHNldHRpbmdzIH0pO1xuICAgICAgLy8gIWUubGlua1VybCBpbXBsaWVzIHRoYXQgeW91IGFyZSBvbiB0aGUgcGFnZSBmb3IgdGhlIHZpZCBvciBwbCB5b3UgYXJlIGFkZGluZyBzbyBpbmZvIGNhbiBiZSBncmFiYmVkXG5cbiAgICAgIC8vIGlmIEkgd2FudCB0byBnZXQgdmlkZW8gYW5kIHBsYXlsaXN0IHRpdGxlcyB3aGVuIHRoZSBsaW5rIGNsaWNrZWQgaXMgdGhlIHdheSB0aGUgdmlkZW8gd2FzIGFkZGVkIHRoZW4gSSBuZWVkIHRvIGRvIGEgZGVlcCBkaXZlIG9uIHRoZSBjb250ZW50IHBhZ2UgYW5kIGl0IGNvdWxkIGJlIGEgcGFpbi5cbiAgICAgIGxldCBhY3Rpb247XG4gICAgICBpZiAoIWUubGlua1VybCkge1xuICAgICAgICBpZiAoaXNQTCAmJiBpc1ZpZCkge1xuICAgICAgICAgIGFjdGlvbiA9ICdnYXRoZXJQTEluZm8yJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhY3Rpb24gPSBpc1BMID8gJ2dhdGhlclBMSW5mbycgOiAnZ2F0aGVyVmlkZW9JbmZvJztcbiAgICAgICAgfVxuICAgICAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWIuaWQsIHsgYWN0aW9uIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aW9uID0gXCJnZXRUaXRsZVwiO1xuICAgICAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWIuaWQsIHsgYWN0aW9uLCB0YXJnZXRVcmw6IHVybCB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5jaHJvbWUudGFicy5xdWVyeSh7fSwgZnVuY3Rpb24odGFicykge1xuICBjb25zdCByZWdleCA9IC9odHRwczpcXC9cXC93d3cueW91dHViZS5jb21cXC8qLztcbiAgY29uc3QgeXRUYWJzID0gQXJyYXkuZnJvbSh0YWJzKVxuICAuZmlsdGVyKHRhYiA9PiByZWdleC50ZXN0KHRhYi51cmwpKTtcbiAgeXRUYWJzLmZvckVhY2godGFiID0+IHtcbiAgICBjaHJvbWUucGFnZUFjdGlvbi5zaG93KHRhYi5pZCk7XG4gIH0pO1xufSk7XG5cbihmdW5jdGlvbigpIHtcbiAgZ2V0U3RvcmFnZUFsbChbJ3NldHRpbmdzJywgJ3ZpZGVvU3RvcmFnZScsICdwbFN0b3JhZ2UnXSlcbiAgLnRoZW4oZGF0YSA9PiB7XG4gICAgZW5zdXJlU2V0dGluZ3MoZGF0YSwgKG5ld0RhdGEpID0+IHtcbiAgICAgIGlmIChuZXdEYXRhLnNldHRpbmdzLmVuYWJsZUNvbnRlbnRCbG9ja2luZykge1xuICAgICAgICBjaHJvbWUudGFicy5xdWVyeSh7fSwgZnVuY3Rpb24odGFicykge1xuICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gL2h0dHBzOlxcL1xcL3d3dy55b3V0dWJlLmNvbVxcLyovO1xuICAgICAgICAgIGNvbnN0IHl0VGFicyA9IEFycmF5LmZyb20odGFicylcbiAgICAgICAgICAuZmlsdGVyKHRhYiA9PiByZWdleC50ZXN0KHRhYi51cmwpKTtcbiAgICAgICAgICB5dFRhYnMuZm9yRWFjaCh0YWIgPT4ge1xuICAgICAgICAgICAgYmxvY2tDb250ZW50KHRhYi5pZCwgdGFiLnVybCwgbmV3RGF0YS5zZXR0aW5ncy5hbGxvd2VkVmlkZW9zLCBuZXdEYXRhLnNldHRpbmdzLmFsbG93ZWRQbGF5bGlzdHMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFsnaGlkZVJlbGF0ZWQnLCAnaGlkZUNvbW1lbnRzJywgJ2hpZGVFbmRTY3JlZW4nXS5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgc2VuZFN0YXRlVG9Db250ZW50KG5ld0RhdGEuc2V0dGluZ3NbZmllbGRdLCBmaWVsZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG5jaHJvbWUudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24odGFiSWQsIGNoYW5nZUluZm8pIHtcbiAgaWYgKGNoYW5nZUluZm8udXJsICYmIFlUX1JFR0VYLnRlc3QoY2hhbmdlSW5mby51cmwpKSB7XG4gICAgLy8gbWFrZSBzdXJlIHRoZSBwb3AgdXAgaXMgb25seSBhdmFpbGFibGUgZm9yIHRoZSBjb3JyZWN0IHBhZ2VzXG4gICAgY29uc3QgaW5mbyA9IHZpZE9yUEwoY2hhbmdlSW5mby51cmwpO1xuICAgIGlmIChpbmZvLmlzUEwgfHwgaW5mby5pc1ZpZCkge1xuICAgICAgY2hyb21lLnBhZ2VBY3Rpb24uc2hvdyh0YWJJZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNocm9tZS5wYWdlQWN0aW9uLmhpZGUodGFiSWQpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB2aWRlb1JlZ2V4ID0gL2h0dHBzOlxcL1xcL3d3dy55b3V0dWJlLmNvbVxcL3dhdGNoKi87XG4gICAgZ2V0U3RvcmFnZSgnc2V0dGluZ3MnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICBpZiAodmlkZW9SZWdleC50ZXN0KGNoYW5nZUluZm8udXJsKSkge1xuICAgICAgICBbJ2hpZGVSZWxhdGVkJywgJ2hpZGVDb21tZW50cycsICdoaWRlRW5kU2NyZWVuJ10uZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoIHRhYklkLCB7IGFjdGlvbjogJ2hpZGVGaWVsZCcsIHZhbHVlOiBkYXRhLnNldHRpbmdzW2ZpZWxkXSwgZmllbGQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdXBkYXRlU3RvcmFnZUluZm9Nc2codGFiSWQsIGNoYW5nZUluZm8udXJsLCBkYXRhLnNldHRpbmdzLmFsbG93ZWRWaWRlb3MsIGRhdGEuc2V0dGluZ3MuYWxsb3dlZFBsYXlsaXN0cyk7XG5cbiAgICAgIGlmIChkYXRhLnNldHRpbmdzLmVuYWJsZUNvbnRlbnRCbG9ja2luZykge1xuICAgICAgICBibG9ja0NvbnRlbnQodGFiSWQsIGNoYW5nZUluZm8udXJsLCBkYXRhLnNldHRpbmdzLmFsbG93ZWRWaWRlb3MsIGRhdGEuc2V0dGluZ3MuYWxsb3dlZFBsYXlsaXN0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cbmNocm9tZS5zdG9yYWdlLm9uQ2hhbmdlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbihjaGFuZ2VzLCBuYW1lc3BhY2UpIHtcbiAgaWYgKGNoYW5nZXMuc2V0dGluZ3MpIHtcbiAgICBjb25zdCB7IG9sZFZhbHVlLCBuZXdWYWx1ZSB9ID0gY2hhbmdlcy5zZXR0aW5ncztcbiAgICBcbiAgICBpZiAob2xkVmFsdWUgJiYgbmV3VmFsdWUpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZW5hYmxlQ29udGVudEJsb2NraW5nOiBvRW5hYmxlQ29udGVudEJsb2NraW5nLFxuICAgICAgICBhbGxvd2VkVmlkZW9zOiBvQWxsb3dlZFZpZGVvcyxcbiAgICAgICAgYWxsb3dlZFBsYXlsaXN0czogb0FsbG93ZWRQbGF5bGlzdHMsXG4gICAgICAgIGhpZGVFbmRTY3JlZW46IG9IaWRlRW5kU2NyZWVuLFxuICAgICAgICBoaWRlUmVsYXRlZDogb0hpZGVSZWxhdGVkLFxuICAgICAgICBoaWRlQ29tbWVudHM6IG9IaWRlQ29tbWVudHNcbiAgICAgIH0gPSBvbGRWYWx1ZTtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZW5hYmxlQ29udGVudEJsb2NraW5nOiBuRW5hYmxlQ29udGVudEJsb2NraW5nLFxuICAgICAgICBhbGxvd2VkVmlkZW9zOiBuQWxsb3dlZFZpZGVvcyxcbiAgICAgICAgYWxsb3dlZFBsYXlsaXN0czogbkFsbG93ZWRQbGF5bGlzdHMsXG4gICAgICAgIGhpZGVFbmRTY3JlZW46IG5IaWRlRW5kU2NyZWVuLFxuICAgICAgICBoaWRlUmVsYXRlZDogbkhpZGVSZWxhdGVkLFxuICAgICAgICBoaWRlQ29tbWVudHM6IG5IaWRlQ29tbWVudHNcbiAgICAgIH0gPSBuZXdWYWx1ZTtcbiAgICAgIGNvbnN0IGJsb2NrRW5hYmxlZCA9ICFvRW5hYmxlQ29udGVudEJsb2NraW5nICYmIG5FbmFibGVDb250ZW50QmxvY2tpbmcsXG4gICAgICAgICAgICB2aWRSZW1vdmVkID0gb0FsbG93ZWRWaWRlb3MubGVuZ3RoID4gbkFsbG93ZWRWaWRlb3MubGVuZ3RoLFxuICAgICAgICAgICAgcGxSZW1vdmVkID0gb0FsbG93ZWRQbGF5bGlzdHMubGVuZ3RoID4gbkFsbG93ZWRQbGF5bGlzdHMubGVuZ3RoLFxuICAgICAgICAgICAgYmxvY2tWaWRzID0gKGJsb2NrRW5hYmxlZCkgfHwgKG5FbmFibGVDb250ZW50QmxvY2tpbmcgJiYgKHZpZFJlbW92ZWQgfHwgcGxSZW1vdmVkKSk7XG4gICAgICBpZiAob0hpZGVSZWxhdGVkICE9PSBuSGlkZVJlbGF0ZWQpIHtcbiAgICAgICAgc2VuZFN0YXRlVG9Db250ZW50KG5IaWRlUmVsYXRlZCwgJ2hpZGVSZWxhdGVkJyk7XG4gICAgICB9IGVsc2UgaWYgKG9IaWRlQ29tbWVudHMgIT09IG5IaWRlQ29tbWVudHMpIHtcbiAgICAgICAgc2VuZFN0YXRlVG9Db250ZW50KG5IaWRlQ29tbWVudHMsICdoaWRlQ29tbWVudHMnKTtcbiAgICAgIH0gZWxzZSBpZiAob0hpZGVFbmRTY3JlZW4gIT09IG5IaWRlRW5kU2NyZWVuKSB7XG4gICAgICAgIHNlbmRTdGF0ZVRvQ29udGVudChuSGlkZUVuZFNjcmVlbiwgJ2hpZGVFbmRTY3JlZW4nKTtcbiAgICAgIH0gZWxzZSBpZiAoYmxvY2tWaWRzKSB7XG4gICAgICAgIGNocm9tZS50YWJzLnF1ZXJ5KHt9LCBmdW5jdGlvbih0YWJzKSB7XG4gICAgICAgICAgQXJyYXkuZnJvbSh0YWJzKS5maWx0ZXIodGFiID0+IFlUX1JFR0VYLnRlc3QodGFiLnVybCkpLmZvckVhY2godGFiID0+IHtcbiAgICAgICAgICAgIGJsb2NrQ29udGVudCh0YWIuaWQsIHRhYi51cmwsIG5BbGxvd2VkVmlkZW9zLCBuQWxsb3dlZFBsYXlsaXN0cyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cbmZ1bmN0aW9uIGVuc3VyZVNldHRpbmdzKGRhdGEsIGNhbGxiYWNrKSB7XG4gIGxldCBwcmV2U2V0dGluZ3MgPSBkYXRhLnNldHRpbmdzIHx8IHt9O1xuICBsZXQgdmlkZW9TdG9yYWdlID0gZGF0YS52aWRlb1N0b3JhZ2UgfHwge307XG4gIGxldCBwbFN0b3JhZ2UgPSBkYXRhLnBsU3RvcmFnZSB8fCB7fTtcblxuICBsZXQgeyBoaWRlUmVsYXRlZCwgaGlkZUNvbW1lbnRzLCBoaWRlRW5kU2NyZWVuLCBlbmFibGVDb250ZW50QmxvY2tpbmcsIGFsbG93ZWRWaWRlb3MsIGFsbG93ZWRQbGF5bGlzdHMgfSA9IHByZXZTZXR0aW5ncztcblxuICBoaWRlUmVsYXRlZCA9IEJvb2xlYW4oaGlkZVJlbGF0ZWQpO1xuICBoaWRlQ29tbWVudHMgPSBCb29sZWFuKGhpZGVDb21tZW50cyk7XG4gIGhpZGVFbmRTY3JlZW4gPSBCb29sZWFuKGhpZGVFbmRTY3JlZW4pO1xuICBlbmFibGVDb250ZW50QmxvY2tpbmcgPSBCb29sZWFuKGVuYWJsZUNvbnRlbnRCbG9ja2luZyk7XG4gIGFsbG93ZWRWaWRlb3MgPSBhbGxvd2VkVmlkZW9zID09PSB1bmRlZmluZWQgPyBbXSA6IGFsbG93ZWRWaWRlb3M7XG4gIGFsbG93ZWRQbGF5bGlzdHMgPSBhbGxvd2VkUGxheWxpc3RzID09PSB1bmRlZmluZWQgPyBbXSA6IGFsbG93ZWRQbGF5bGlzdHM7XG4gIHZpZGVvU3RvcmFnZSA9IHZpZGVvU3RvcmFnZSA9PT0gdW5kZWZpbmVkID8ge30gOiB2aWRlb1N0b3JhZ2U7XG4gIHBsU3RvcmFnZSA9IHBsU3RvcmFnZSA9PT0gdW5kZWZpbmVkID8ge30gOiBwbFN0b3JhZ2U7XG4gIGNvbnN0IHNldHRpbmdzID0geyBoaWRlUmVsYXRlZCwgaGlkZUNvbW1lbnRzLCBoaWRlRW5kU2NyZWVuLCBlbmFibGVDb250ZW50QmxvY2tpbmcsIGFsbG93ZWRWaWRlb3MsIGFsbG93ZWRQbGF5bGlzdHMgfTtcbiAgLy91cGRhdGUgc3RvcmFnZSB1c2UgdG8gbmV3IHNldCBmdW5jdGlvblxuICBsZXQgbmV3RGF0YSA9IHt9O1xuICBzZXRTdG9yYWdlKCdzZXR0aW5ncycsIHsgc2V0dGluZ3MgfSkudGhlbihkYXRhID0+IHtcbiAgICBuZXdEYXRhID0gT2JqZWN0LmFzc2lnbihuZXdEYXRhLCBkYXRhKTtcbiAgICByZXR1cm4gc2V0U3RvcmFnZSgncGxTdG9yYWdlJywgeyBwbFN0b3JhZ2UgfSk7XG4gIH0pLnRoZW4oZGF0YSA9PiB7XG4gICAgbmV3RGF0YSA9IE9iamVjdC5hc3NpZ24obmV3RGF0YSwgZGF0YSk7XG4gICAgcmV0dXJuIHNldFN0b3JhZ2UoJ3ZpZGVvU3RvcmFnZScsIHsgdmlkZW9TdG9yYWdlIH0pO1xuICB9KS50aGVuKGRhdGEgPT4ge1xuICAgIG5ld0RhdGEgPSBPYmplY3QuYXNzaWduKG5ld0RhdGEsIGRhdGEpO1xuICAgIGNhbGxiYWNrKG5ld0RhdGEpO1xuICB9KTtcbiAgLy9jaGVjayB0byBtYWtlc3VyZSB0aGlzIHdvcmtzIVxufVxuXG5mdW5jdGlvbiB1cGRhdGVTdG9yYWdlSW5mb01zZyh0YWJJZCwgdXJsLCBhbGxvd2VkVmlkZW9zLCBhbGxvd2VkUGxheWxpc3RzKSB7XG4gIGNvbnN0IHsgaXNQTCwgUGxJRCwgaXNWaWQsIHZpZElELCBub3RZdCB9ID0gdmlkT3JQTCh1cmwpO1xuICBpZiAoIGlzUEwgJiYgaXNWaWQpIHtcbiAgICBpZiAoYWxsb3dlZFZpZGVvcy5pbmNsdWRlcyh2aWRJRCkgfHwgYWxsb3dlZFBsYXlsaXN0cy5pbmNsdWRlcyhQbElEKSkge1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiSWQsIHsgYWN0aW9uOiAnZ2F0aGVyUExJbmZvMicgfSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGlzUEwpIHtcbiAgICBpZiAoYWxsb3dlZFBsYXlsaXN0cy5pbmNsdWRlcyhQbElEKSkge1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiSWQsIHsgYWN0aW9uOiAnZ2F0aGVyUExJbmZvJyB9KTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoaXNWaWQpIHtcbiAgICBpZiAoYWxsb3dlZFZpZGVvcy5pbmNsdWRlcyh2aWRJRCkpIHtcbiAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYklkLCB7IGFjdGlvbjogJ2dhdGhlclZpZGVvSW5mbycgfSk7XG4gICAgfVxuXG4gIH1cbn1cblxuZnVuY3Rpb24gbG9nVG9Db250ZW50KHRleHQpIHtcbiAgY29uc3QgbWVzc2FnZSA9IHsgYWN0aW9uOiAnbG9nJywgbWVzc2FnZTogdGV4dCB9O1xuICBjaHJvbWUudGFicy5xdWVyeSh7fSwgZnVuY3Rpb24odGFicykge1xuICAgIEFycmF5LmZyb20odGFicylcbiAgICAuZm9yRWFjaCh0YWIgPT4gY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCBtZXNzYWdlKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzZW5kU3RhdGVUb0NvbnRlbnQodmFsdWUsIGZpZWxkLCB0YWJJZCkge1xuICB2YXIgbWVzc2FnZSA9IHsgYWN0aW9uOiAnaGlkZUZpZWxkJywgdmFsdWUsIGZpZWxkIH07XG4gIGlmICh0YWJJZCkge1xuICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYklkLCBtZXNzYWdlKTtcbiAgfVxuICBjaHJvbWUudGFicy5xdWVyeSh7fSwgZnVuY3Rpb24odGFicykge1xuICAgIEFycmF5LmZyb20odGFicylcbiAgICAuZm9yRWFjaCh0YWIgPT4gY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCBtZXNzYWdlKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBibG9ja0NvbnRlbnQodGFiSWQsIHVybCwgYWxsb3dlZFZpZGVvcywgYWxsb3dlZFBsYXlsaXN0cykge1xuICBjb25zdCB7IGlzUEwsIFBsSUQsIGlzVmlkLCB2aWRJRCwgbm90WXQgfSA9IHZpZE9yUEwodXJsKTtcbiAgY29uc3QgcGFnZUlzbnRBbGxvd2VkID0gKCgoaXNWaWQgJiYgIWlzUEwpICYmICFhbGxvd2VkVmlkZW9zLmluY2x1ZGVzKHZpZElEKSkgfHwgKGlzUEwgJiYgIWFsbG93ZWRQbGF5bGlzdHMuaW5jbHVkZXMoUGxJRCkpIHx8ICghaXNWaWQgJiYgIWlzUEwgJiYgIW5vdFl0KSk7XG4gIGlmIChwYWdlSXNudEFsbG93ZWQpIHtcbiAgICBjaHJvbWUudGFicy51cGRhdGUodGFiSWQsIHt1cmw6ICdub3RfYXZhaWxhYmxlL25vdF9hdmFpbGFibGUuaHRtbCd9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgVklEX1BMX1JFR0VYIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5cbmV4cG9ydCBjb25zdCB2aWRPclBMID0gKHVybCkgPT4ge1xuICBjb25zdCByZXMgPSB1cmwubWF0Y2goVklEX1BMX1JFR0VYKTtcbiAgcmV0dXJuIHsgaXNQTDogQm9vbGVhbihyZXNbMV0gfHwgcmVzWzddKSxcbiAgICAgICAgICAgUGxJRDogcmVzWzJdIHx8IHJlc1s4XSxcbiAgICAgICAgICAgaXNWaWQ6IEJvb2xlYW4oKHJlc1szXSAmJiByZXNbNF0pKSxcbiAgICAgICAgICAgdmlkSUQ6IHJlc1s0XSB9O1xufTtcbiIsImV4cG9ydCBjb25zdCBZVF9SRUdFWCA9IC9odHRwczpcXC9cXC93d3cueW91dHViZS5jb21cXC8qLztcblxuZXhwb3J0IGNvbnN0IFZJRF9QTF9SRUdFWCA9IC9odHRwczpcXC9cXC93d3dcXC55b3V0dWJlXFwuY29tXFwvKHBsYXlsaXN0XFw/bGlzdD0oLispKT8od2F0Y2hcXD92PShbQS1aYS16MC05Xy1dezExfSkpPygmdD1bXiZdKyk/KCZpbmRleFteJl0rKT8oJmxpc3Q9KFteJl0rKT8pPygmLiopPy87XG4iXSwic291cmNlUm9vdCI6IiJ9